# èªè¨¼è¨­è¨ˆã‚¬ã‚¤ãƒ‰

ã“ã®æ–‡æ›¸ã¯ã€ãƒ¡ãƒ¢ãƒ™ãƒ¼ã‚¹ Todo ã‚¢ãƒ—ãƒªã®èªè¨¼æ–¹å¼ã€ãƒ•ãƒ­ãƒ¼ã€æ®µéšçš„ãªå®Ÿè£…è¨ˆç”»ã‚’å®šç¾©ã—ã¾ã™ã€‚

## è¨­è¨ˆæ–¹é‡

### ç›®æ¨™

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼è² è·ã®æœ€å°åŒ–**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ã‚’æ’é™¤ã—ã€ç”Ÿä½“èªè¨¼ã§ç°¡å˜ã«ãƒ­ã‚°ã‚¤ãƒ³
- **ã‚¯ãƒ­ã‚¹ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œ**: ã©ã®ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ã§ã‚‚åŒã˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **ä½ã„èªè¨¼é »åº¦**: é•·æœŸã‚»ãƒƒã‚·ãƒ§ãƒ³ç¶­æŒã§å†èªè¨¼ã®æ‰‹é–“ã‚’å‰Šæ¸›
- **å°†æ¥ã®ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ**: DB è¨­è¨ˆã¯å¤‰æ›´ä¸è¦ã§èªè¨¼å±¤ã®ã¿æ”¹ä¿®å¯èƒ½ãªæ§‹æˆ

### æŠ€è¡“é¸å®š

| é …ç›®           | é¸å®š                             | ç†ç”±                                         |
| -------------- | -------------------------------- | -------------------------------------------- |
| èªè¨¼æ–¹å¼       | ãƒ‘ã‚¹ã‚­ãƒ¼ï¼ˆWebAuthnï¼‰             | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸è¦ã€ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°è€æ€§ã€UX è‰¯å¥½    |
| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª     | NextAuth.js v5 + @simplewebauthn | Next.js App Router å¯¾å¿œã€WebAuthn å®Ÿè£…ãŒå®¹æ˜“ |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³     | JWTï¼ˆ30 æ—¥æœ‰åŠ¹ï¼‰                 | DB ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ä¸è¦ã€é•·æœŸç¶­æŒå¯èƒ½      |
| ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ | ãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒã‚¤ã‚¹è¿½åŠ æ™‚ï¼‰   | QR ã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šå®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«                  |

---

## æ®µéšçš„å®Ÿè£…è¨ˆç”»

### MVP (Tier 1) â€” ã‚·ãƒ³ã‚°ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼

æœ€åˆã®ã‚¢ã‚¯ã‚»ã‚¹è€…ãŒå”¯ä¸€ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã€ä»¥é™ã®æ–°è¦ç™»éŒ²ã¯ä¸å¯ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MVP èªè¨¼ãƒ¢ãƒ‡ãƒ«                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: 1äººã®ã¿                                  â”‚
â”‚  â€¢ èªè¨¼æ–¹å¼: ãƒ‘ã‚¹ã‚­ãƒ¼ï¼ˆWebAuthnï¼‰                       â”‚
â”‚  â€¢ ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ : ãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ï¼ˆ6æ¡ã€æœ‰åŠ¹æœŸé™5åˆ†ï¼‰       â”‚
â”‚  â€¢ ã‚»ãƒƒã‚·ãƒ§ãƒ³: JWT 30æ—¥ï¼ˆã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°å»¶é•·ï¼‰           â”‚
â”‚  â€¢ åŒæ™‚ãƒ‡ãƒã‚¤ã‚¹æ•°: åˆ¶é™ãªã—                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### MVP ã§ã®èªè¨¼ãƒ•ãƒ­ãƒ¼

**A. åˆå›ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æœªç™»éŒ²çŠ¶æ…‹ï¼‰**

```
ãƒ–ãƒ©ã‚¦ã‚¶                        ã‚µãƒ¼ãƒãƒ¼                      DB
   â”‚                              â”‚                          â”‚
   â”‚  GET /                       â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                              â”‚  User.count()            â”‚
   â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                              â”‚  count = 0               â”‚
   â”‚                              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                              â”‚                          â”‚
   â”‚  ã€Œç™»éŒ²ç”»é¢ã€è¡¨ç¤º            â”‚                          â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²é–‹å§‹            â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  WebAuthn Challenge          â”‚                          â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  ç”Ÿä½“èªè¨¼ï¼ˆæŒ‡ç´‹/é¡”ï¼‰         â”‚                          â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  Credential é€ä¿¡             â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                              â”‚  User + Credential ä½œæˆ  â”‚
   â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                              â”‚                          â”‚
   â”‚  JWT Cookie è¨­å®š             â”‚                          â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸         â”‚                          â”‚
```

**B. 2 å›ç›®ä»¥é™ã®ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ¸ˆã¿ã€æœªèªè¨¼ï¼‰**

```
ãƒ–ãƒ©ã‚¦ã‚¶                        ã‚µãƒ¼ãƒãƒ¼                      DB
   â”‚                              â”‚                          â”‚
   â”‚  GET /                       â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                              â”‚  User.count()            â”‚
   â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                              â”‚  count = 1               â”‚
   â”‚                              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚                              â”‚                          â”‚
   â”‚  ã€Œã‚µã‚¤ãƒ³ã‚¤ãƒ³ç”»é¢ã€è¡¨ç¤º      â”‚                          â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  ãƒ‘ã‚¹ã‚­ãƒ¼èªè¨¼é–‹å§‹            â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  WebAuthn Challenge          â”‚                          â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  ç”Ÿä½“èªè¨¼ï¼ˆæŒ‡ç´‹/é¡”ï¼‰         â”‚                          â”‚
   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  Assertion é€ä¿¡              â”‚                          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
   â”‚                              â”‚  Credential æ¤œè¨¼         â”‚
   â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                              â”‚                          â”‚
   â”‚  JWT Cookie è¨­å®š             â”‚                          â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
   â”‚                              â”‚                          â”‚
   â”‚  âœ… ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸         â”‚                          â”‚
```

**C. ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ ï¼ˆæ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ–°ãƒ‡ãƒã‚¤ã‚¹ã‚’è¿½åŠ ï¼‰**

```
æ—¢å­˜ãƒ‡ãƒã‚¤ã‚¹                   ã‚µãƒ¼ãƒãƒ¼                   æ–°ãƒ‡ãƒã‚¤ã‚¹
     â”‚                           â”‚                           â”‚
     â”‚  ã€Œãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã€      â”‚                           â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
     â”‚                           â”‚  6æ¡ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ             â”‚
     â”‚                           â”‚  (æœ‰åŠ¹æœŸé™5åˆ†ã€1å›é™ã‚Š)    â”‚
     â”‚  ã‚³ãƒ¼ãƒ‰è¡¨ç¤º: "123456"     â”‚                           â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚  ã€Œæ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æ¥ç¶šã€  â”‚
     â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚  ã‚³ãƒ¼ãƒ‰å…¥åŠ›: "123456"     â”‚
     â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚  ã‚³ãƒ¼ãƒ‰æ¤œè¨¼ OK            â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚  WebAuthn Challenge       â”‚
     â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚  ç”Ÿä½“èªè¨¼                 â”‚
     â”‚                           â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚  Credential é€ä¿¡          â”‚
     â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚  æ–° Credential è¿½åŠ        â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚  JWT Cookie è¨­å®š          â”‚
     â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚  âœ… åˆ©ç”¨é–‹å§‹              â”‚
```

---

### å°†æ¥ (Tier 2+) â€” ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ

èªè¨¼å±¤ã‚’æ”¹ä¿®ã—ã€è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬ç«‹ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç®¡ç†ã§ãã‚‹æ§‹æˆã«æ‹¡å¼µã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å°†æ¥ã®èªè¨¼ãƒ¢ãƒ‡ãƒ«                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°: è¤‡æ•°ï¼ˆå„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‹¬ç«‹ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒï¼‰ â”‚
â”‚  â€¢ åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«ã€Œæ–°è¦ or æ—¢å­˜ã€é¸æŠUI               â”‚
â”‚  â€¢ ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ : QRã‚³ãƒ¼ãƒ‰ + æ—¢å­˜ãƒ‡ãƒã‚¤ã‚¹ã§ã®æ‰¿èª        â”‚
â”‚  â€¢ æ‹›å¾…æ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å°†æ¥ã®åˆå›ã‚¢ã‚¯ã‚»ã‚¹ UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                     â”‚
â”‚     ğŸ“ ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªã¸ã‚ˆã†ã“ã          â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ†• æ–°ã—ãå§‹ã‚ã‚‹            â”‚   â”‚
â”‚  â”‚  ï¼ˆæ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ç™»éŒ²ï¼‰   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ”— æ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æ¥ç¶š     â”‚   â”‚
â”‚  â”‚  ï¼ˆä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ãƒªãƒ³ã‚¯ï¼‰   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¤‰æ›´ç‚¹ï¼ˆMVP â†’ å°†æ¥ï¼‰

| é …ç›®         | MVP            | å°†æ¥             |
| ------------ | -------------- | ---------------- |
| åˆå›ã‚¢ã‚¯ã‚»ã‚¹ | å³ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ² | é¸æŠ UI è¡¨ç¤º     |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¶é™ | 1 äººã®ã¿       | ç„¡åˆ¶é™           |
| ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ  | ãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰   | QR ã‚³ãƒ¼ãƒ‰ + æ‰¿èª |
| DB è¨­è¨ˆ      | å¤‰æ›´ä¸è¦       | å¤‰æ›´ä¸è¦         |
| èªè¨¼å±¤       | ã‚·ãƒ³ãƒ—ãƒ«       | UI/ãƒ•ãƒ­ãƒ¼è¿½åŠ     |

**ãƒã‚¤ãƒ³ãƒˆ**: `ownerId` ã«ã‚ˆã‚‹è¨­è¨ˆãŒæ—¢ã«å®Œäº†ã—ã¦ã„ã‚‹ãŸã‚ã€**èªè¨¼å±¤ã®ã¿ã®æ”¹ä¿®ã§ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œå¯èƒ½**ã€‚

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### æ—¢å­˜ãƒ¢ãƒ‡ãƒ«ï¼ˆå¤‰æ›´ä¸è¦ï¼‰

```prisma
model User {
  id           String   @id @default(cuid())
  name         String?
  email        String?  @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  notes        Note[]
  projects     Project[]
  tags         Tag[]
  tasks        Task[]
  credentials  Credential[]  // è¿½åŠ 
}
```

### è¿½åŠ ãƒ¢ãƒ‡ãƒ«

```prisma
// ãƒ‘ã‚¹ã‚­ãƒ¼ï¼ˆWebAuthn Credentialï¼‰ã‚’ä¿å­˜
model Credential {
  id                  String   @id @default(cuid())
  userId              String
  credentialId        Bytes    @unique  // WebAuthn credential ID
  publicKey           Bytes              // å…¬é–‹éµ
  counter             BigInt             // ç½²åã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆãƒªãƒ—ãƒ¬ã‚¤æ”»æ’ƒé˜²æ­¢ï¼‰
  deviceType          String?            // "singleDevice" | "multiDevice"
  backedUp            Boolean  @default(false)
  transports          String[] // ["internal", "hybrid", etc.]
  createdAt           DateTime @default(now())
  lastUsedAt          DateTime?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

// ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ ç”¨ãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰
model LinkCode {
  id        String   @id @default(cuid())
  userId    String
  code      String   @unique  // 6æ¡ã‚³ãƒ¼ãƒ‰
  expiresAt DateTime           // æœ‰åŠ¹æœŸé™ï¼ˆ5åˆ†ï¼‰
  usedAt    DateTime?          // ä½¿ç”¨æ¸ˆã¿ãƒ•ãƒ©ã‚°
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([code])
}
```

---

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
  server/
    auth/
      index.ts                 # çµ±ä¸€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
      auth.config.ts           # NextAuth è¨­å®šï¼ˆWebAuthn providerï¼‰
      session.ts               # getCurrentUser(), requireAuth()
      webauthn.ts              # WebAuthn ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆç™»éŒ²/èªè¨¼ï¼‰
      link-code.ts             # ãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ/æ¤œè¨¼
  app/
    (auth)/
      page.tsx                 # èªè¨¼ãƒ«ãƒ¼ãƒˆï¼ˆç™»éŒ² or ã‚µã‚¤ãƒ³ã‚¤ãƒ³åˆ¤å®šï¼‰
      register/page.tsx        # ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ç”»é¢
      signin/page.tsx          # ãƒ‘ã‚¹ã‚­ãƒ¼èªè¨¼ç”»é¢
      link/page.tsx            # ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ ç”»é¢
    api/
      auth/
        [...nextauth]/route.ts # NextAuth ãƒãƒ³ãƒ‰ãƒ©
        webauthn/
          register/
            options/route.ts   # ç™»éŒ²ã‚ªãƒ—ã‚·ãƒ§ãƒ³å–å¾—
            verify/route.ts    # ç™»éŒ²æ¤œè¨¼
          authenticate/
            options/route.ts   # èªè¨¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³å–å¾—
            verify/route.ts    # èªè¨¼æ¤œè¨¼
        link-code/
          generate/route.ts    # ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
          verify/route.ts      # ã‚³ãƒ¼ãƒ‰æ¤œè¨¼
```

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

### è¨­å®š

```typescript
// auth.config.ts
export const authConfig = {
  session: {
    strategy: "jwt",
    maxAge: 30 * 24 * 60 * 60, // 30æ—¥
  },
  jwt: {
    maxAge: 30 * 24 * 60 * 60, // 30æ—¥
  },
  callbacks: {
    jwt({ token, user }) {
      if (user) {
        token.id = user.id;
      }
      return token;
    },
    session({ session, token }) {
      session.user.id = token.id as string;
      return session;
    },
  },
};
```

### ã‚¹ãƒ©ã‚¤ãƒ‡ã‚£ãƒ³ã‚°ã‚»ãƒƒã‚·ãƒ§ãƒ³

ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªå‹•çš„ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå»¶é•·ã•ã‚Œã‚‹ï¼š

- æœ€çµ‚ã‚¢ã‚¯ã‚»ã‚¹ã‹ã‚‰ 30 æ—¥ã§æœŸé™åˆ‡ã‚Œ
- ã‚¢ã‚¯ã‚»ã‚¹ã®ãŸã³ã«ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ›´æ–°ã•ã‚Œã‚‹

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### ãƒ‘ã‚¹ã‚­ãƒ¼ã®ãƒ¡ãƒªãƒƒãƒˆ

| è¦³ç‚¹             | ãƒ‘ã‚¹ã‚­ãƒ¼                    | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰                    |
| ---------------- | --------------------------- | ----------------------------- |
| ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°     | âœ… è€æ€§ã‚ã‚Šï¼ˆã‚ªãƒªã‚¸ãƒ³æ¤œè¨¼ï¼‰ | âŒ å½ã‚µã‚¤ãƒˆã«å…¥åŠ›ã•ã‚Œã‚‹å¯èƒ½æ€§ |
| æ¼æ´©ãƒªã‚¹ã‚¯       | âœ… ç§˜å¯†éµã¯ãƒ‡ãƒã‚¤ã‚¹å†…       | âŒ DB æ¼æ´©æ™‚ã«å±é™º            |
| ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹ | âœ… ä¸å¯èƒ½                   | âš ï¸ å¯¾ç­–å¿…è¦                   |
| UX               | âœ… æŒ‡ç´‹/é¡”ã§ 1 ã‚¿ãƒƒãƒ—       | âŒ å…¥åŠ›ãŒé¢å€’                 |

### ãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **æœ‰åŠ¹æœŸé™**: 5 åˆ†ï¼ˆçŸ­æ™‚é–“ã§å¤±åŠ¹ï¼‰
- **1 å›é™ã‚Š**: ä½¿ç”¨å¾Œã¯ç„¡åŠ¹åŒ–
- **æ¨æ¸¬å›°é›£**: 6 æ¡è‹±æ•°å­—ï¼ˆ36^6 â‰ˆ 22 å„„é€šã‚Šï¼‰
- **ãƒ¬ãƒ¼ãƒˆåˆ¶é™**: ç”Ÿæˆã¯ 1 åˆ†ã« 1 å›ã¾ã§

### ç’°å¢ƒå¤‰æ•°

```env
# å¿…é ˆ
NEXTAUTH_SECRET=your-secret-key-here
NEXTAUTH_URL=http://localhost:3000

# WebAuthn
WEBAUTHN_RP_ID=localhost           # æœ¬ç•ª: your-domain.com
WEBAUTHN_RP_NAME=ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒª
WEBAUTHN_ORIGIN=http://localhost:3000
```

---

## å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1: åŸºæœ¬èªè¨¼ï¼ˆMVPï¼‰

1. [ ] Prisma ã‚¹ã‚­ãƒ¼ãƒã« `Credential`, `LinkCode` ãƒ¢ãƒ‡ãƒ«è¿½åŠ 
2. [ ] NextAuth + WebAuthn è¨­å®š
3. [ ] ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼
4. [ ] ãƒ‘ã‚¹ã‚­ãƒ¼èªè¨¼ãƒ•ãƒ­ãƒ¼
5. [ ] ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆ30 æ—¥ JWTï¼‰

### Phase 2: ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ ï¼ˆMVPï¼‰

6. [ ] ãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ API
7. [ ] ãƒªãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰æ¤œè¨¼ + ãƒ‘ã‚¹ã‚­ãƒ¼ç™»éŒ²ãƒ•ãƒ­ãƒ¼
8. [ ] æ—¢å­˜ãƒ‡ãƒã‚¤ã‚¹ã§ã®ã‚³ãƒ¼ãƒ‰è¡¨ç¤º UI

### Phase 3: ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆå°†æ¥ï¼‰

9. [ ] åˆå›ã‚¢ã‚¯ã‚»ã‚¹é¸æŠ UI
10. [ ] QR ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ãƒ‡ãƒã‚¤ã‚¹è¿½åŠ 
11. [ ] æ‹›å¾…æ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```json
{
  "dependencies": {
    "next-auth": "^5.0.0-beta",
    "@simplewebauthn/server": "^9.0.0",
    "@simplewebauthn/browser": "^9.0.0"
  },
  "devDependencies": {
    "@simplewebauthn/types": "^9.0.0"
  }
}
```

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `docs/architecture.md` â€” ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å…¨ä½“è¨­è¨ˆ
- `docs/tech-stack.md` â€” æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ä¸€è¦§
- `docs/feature-tiers.md` â€” æ©Ÿèƒ½å„ªå…ˆåº¦
- `docs/data-model.md` â€” ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«è©³ç´°
